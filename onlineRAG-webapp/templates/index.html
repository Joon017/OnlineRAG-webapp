<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Corona Admin</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="../../static/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../static/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="../../static/vendors/jvectormap/jquery-jvectormap.css">
    <link rel="stylesheet" href="../../static/vendors/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="../../static/vendors/owl-carousel-2/owl.carousel.min.css">
    <link rel="stylesheet" href="../../static/vendors/owl-carousel-2/owl.theme.default.min.css">
    <!-- End plugin css for this page -->4
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="../../static/css/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="../../static/images/favicon.png" />
    <style>

  #spinner-overlay{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);  /* Translucent black background */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;  /* Adjust the z-index as needed to ensure it's on top of other elements */
}

.spinner-border {
    color: white;  /* Adjust the color of the spinner as needed */
}

      .btn-spacing {
          margin-right: 10px; /* Adjust the spacing as needed */
      }

      .table-container {
      height: 200px; /* Set a fixed height for the table container */
      overflow-y: auto;
    }

    .dropzone {
      background-color: #000;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      color: #fff;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 200px; /* Set a fixed height for better centering */
    }

    .dropzone p {
      margin: 0; /* Remove default margin */
    }


    #fileList {
      margin-top: 20px;
    }
 .blur-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(10px); /* Adjust the blur radius as needed */
    z-index: 1; /* Ensure it's above the card body */
    display: none; /* Initially hidden */
}

.loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2; /* Ensure it's above the blur overlay */
}
      .bottom-floating-div {
      position: absolute;
      bottom: 0;
      width: 100%;
      background-color: #f0f0f0;
      padding: 10px;
      text-align: center;
    }

      .search-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 10px;
        border-top: 1px solid #ddd; /* Add a border if desired */
        box-shadow: 0px -2px 5px rgba(0, 0, 0, 0.1); /* Optional: Add a box shadow */
        z-index: 5;
      }

    </style>
  </head>
  <body>
    <div class="container-scroller">

      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
          <h2> <b> RAG-E </b> </h2>
          <a class="sidebar-brand brand-logo-mini" href="index.html"><img src="../../static/images/logo-mini.svg" alt="logo" /></a>
        </div>
        zz
        <ul class="nav">
          <li class="nav-item profile">
            <div class="profile-desc">
              <div class="profile-pic">
                <div class="count-indicator">
                  <img class="img-xs rounded-circle " src="../../static/images/faces/face15.jpg" alt="">
                  <span class="count bg-success"></span>
                </div>
                <div class="profile-name">
                  <h5 class="mb-0 font-weight-normal">User</h5>
                </div>
              </div>
              <a href="#" id="profile-dropdown" data-bs-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
              <div class="dropdown-menu dropdown-menu-right sidebar-dropdown preview-list" aria-labelledby="profile-dropdown">
                <a href="#" class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-settings text-primary"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <p class="preview-subject ellipsis mb-1 text-small">Account settings</p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-onepassword  text-info"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <p class="preview-subject ellipsis mb-1 text-small">Change Password</p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-calendar-today text-success"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <p class="preview-subject ellipsis mb-1 text-small">To-do list</p>
                  </div>
                </a>
              </div>
            </div>
          </li>
          <li class="nav-item nav-category">
            <span class="nav-link">Tool</span>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="index.html">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
              <span class="menu-title">Document <Query></Query></span>
            </a>
          </li>

            <li class="nav-item nav-category">
            <span class="nav-link">Session</span>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="index.html">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
              <span class="menu-title">Session 1</span>

            </a>
          </li>







        </ul>
      </nav>
      <!-- partial -->
      <d  iv class="container-fluid page-body-wrapper">
        <!-- partial:partials/_navbar.html -->
        <nav class="navbar p-0 fixed-top d-flex flex-row">
          <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
            <a class="navbar-brand brand-logo-mini" href="index.html"><img src="../../static/images/logo-mini.svg" alt="logo" /></a>
          </div>
          <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
              <span class="mdi mdi-menu"></span>
            </button>
            <ul class="navbar-nav w-100">
              <li class="nav-item w-100">
                <form class="nav-link mt-2 mt-md-0 d-none d-lg-flex search">
                </form>
              </li>
            </ul>
            <ul class="navbar-nav navbar-nav-right">
              <li class="nav-item dropdown d-none d-lg-block">
                <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" aria-labelledby="createbuttonDropdown">
                  <h6 class="p-3 mb-0">Projects</h6>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item preview-item">
                    <div class="preview-thumbnail">
                      <div class="preview-icon bg-dark rounded-circle">
                        <i class="mdi mdi-file-outline text-primary"></i>
                      </div>
                    </div>
                    <div class="preview-item-content">
                      <p class="preview-subject ellipsis mb-1">Software Development</p>
                    </div>
                  </a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item preview-item">
                    <div class="preview-thumbnail">
                      <div class="preview-icon bg-dark rounded-circle">
                        <i class="mdi mdi-web text-info"></i>
                      </div>
                    </div>
                    <div class="preview-item-content">
                      <p class="preview-subject ellipsis mb-1">UI Development</p>
                    </div>
                  </a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item preview-item">
                    <div class="preview-thumbnail">
                      <div class="preview-icon bg-dark rounded-circle">
                        <i class="mdi mdi-layers text-danger"></i>
                      </div>
                    </div>
                    <div class="preview-item-content">
                      <p class="preview-subject ellipsis mb-1">Software Testing</p>
                    </div>
                  </a>
                  <div class="dropdown-divider"></div>
                  <p class="p-3 mb-0 text-center">See all projects</p>
                </div>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link" id="profileDropdown" href="#" data-bs-toggle="dropdown">
                  <div class="navbar-profile">
                    <p class="mb-0 d-none d-sm-block navbar-profile-name">Default User</p>
                    <i class="mdi mdi-menu-down d-none d-sm-block"></i>
                  </div>
                </a>
                <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" aria-labelledby="profileDropdown">
                  <h6 class="p-3 mb-0">Profile</h6>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item preview-item">
                    <div class="preview-thumbnail">
                      <div class="preview-icon bg-dark rounded-circle">
                        <i class="mdi mdi-settings text-success"></i>
                      </div>
                    </div>
                    <div class="preview-item-content">
                      <p class="preview-subject mb-1">Settings</p>
                    </div>
                  </a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item preview-item">
                    <div class="preview-thumbnail">
                      <div class="preview-icon bg-dark rounded-circle">
                        <i class="mdi mdi-logout text-danger"></i>
                      </div>
                    </div>
                    <div class="preview-item-content">
                      <p class="preview-subject mb-1">Log out</p>
                      <a href="{{ url_for('logout') }}">Logout</a>
                    </div>
                  </a>
                  <div class="dropdown-divider"></div>
                  <p class="p-3 mb-0 text-center">Advanced settings</p>
                </div>
              </li>
            </ul>
            <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
              <span class="mdi mdi-format-line-spacing"></span>
            </button>
          </div>
        </nav>



        <!-- partial -->
        <div class="main-panel">

          <div class="content-wrapper">




<!--            <div class="row">-->
<!--              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">-->
<!--                <div class="card">-->
<!--                  <div class="card-body">-->
<!--                    <div class="row">-->
<!--                      <div class="col-9">-->
<!--                        <div class="d-flex align-items-center align-self-start">-->
<!--                          <h3 class="mb-0">5</h3>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                      <div class="col-3">-->
<!--                        <div class="icon icon-box-success ">-->
<!--                          <span class="mdi mdi-arrow-top-right icon-item"></span>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                    <h6 class="text-muted font-weight-normal">Number of documents</h6>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">-->
<!--                <div class="card">-->
<!--                  <div class="card-body">-->
<!--                    <div class="row">-->
<!--                      <div class="col-9">-->
<!--                        <div class="d-flex align-items-center align-self-start">-->
<!--                          <h3 class="mb-0">2</h3>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                      <div class="col-3">-->
<!--                        <div class="icon icon-box-success">-->
<!--                          <span class="mdi mdi-arrow-top-right icon-item"></span>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                    <h6 class="text-muted font-weight-normal">Word count</h6>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">-->
<!--                <div class="card">-->
<!--                  <div class="card-body">-->
<!--                    <div class="row">-->
<!--                      <div class="col-9">-->
<!--                        <div class="d-flex align-items-center align-self-start">-->
<!--                          <h3 class="mb-0">121</h3>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                      <div class="col-3">-->
<!--                        <div class="icon icon-box-danger">-->
<!--                          <span class="mdi mdi-arrow-bottom-left icon-item"></span>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                    <h6 class="text-muted font-weight-normal">Token count</h6>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">-->
<!--                <div class="card">-->
<!--                  <div class="card-body">-->
<!--                    <div class="row">-->
<!--                      <div class="col-9">-->
<!--                        <div class="d-flex align-items-center align-self-start">-->
<!--                          <h3 class="mb-0">3</h3>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                      <div class="col-3">-->
<!--                        <div class="icon icon-box-success ">-->
<!--                          <span class="mdi mdi-arrow-top-right icon-item"></span>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                    <h6 class="text-muted font-weight-normal">Article sources</h6>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

            <br>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const dropzone = document.getElementById('dropzone');
    const fileList = document.getElementById('fileList');

    dropzone.addEventListener('dragover', function (e) {
      e.preventDefault();
      dropzone.classList.add('border-primary');
    });

    dropzone.addEventListener('dragleave', function () {
      dropzone.classList.remove('border-primary');
    });

    dropzone.addEventListener('drop', function (e) {
      e.preventDefault();
      dropzone.classList.remove('border-primary');

      const files = e.dataTransfer.files;
      handleFiles(files);
    });

    dropzone.addEventListener('click', function () {
      document.getElementById('formFileMultiple').click();
    });

    document.getElementById('formFileMultiple').addEventListener('change', function () {
      const files = this.files;
      handleFiles(files);
    });

    function handleFiles(files) {
      fileList.innerHTML = '';

      for (const file of files) {
        const listItem = document.createElement('div');
        listItem.textContent = file.name;
        fileList.appendChild(listItem);
      }
    }
  });
</script>

            <script>
    function resetFolders() {
        // Send a GET request to the /delete_folders endpoint
        fetch('/reset', {
            method: 'GET',
        })
        .then(response => response.json())
        .then(data => {
            // Update the interface based on the server response
            console.log(data.message);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>

            <!-- Add the spinner overlay element -->
<div id="spinner-overlay" style="display: none;">
    <div class="spinner-border" role="status">
    </div>
  <div id="processing-text" class="mt-2 mx-5"> <h3> Processing files... This might take a while </h3> </div>
</div>

            <div class="row">
              <div class="col-md-7 grid-margin stretch-card">
    <div class="card" style="height: 800px">
      <!-- Translucent overlay for loading indicator -->
    <div class="blur-overlay" id="blur-overlay"></div>
   <div class="card-header" style="padding: 20px; overflow: hidden;">
    <div style="float: right;">
        <button type="button" class="btn btn-inverse-secondary btn-fw" onclick="saveConversation()">Save Conversation <i class="mdi mdi-download"></i> </button>

    </div>
</div>
    <div class="card-body" style="height: calc(100% - 60px); overflow-y: auto;">
            <div id="chat-container"></div>
        </div>
       <div class="card-footer text-muted">
         <div class="input-group mb-3">
  <input type="text" class="form-control" style="color: white;" id="user-input" placeholder="Ask a question..." aria-label="Recipient's username" aria-describedby="basic-addon2">
  <div class="input-group-append">
    <button onclick="sendMessage()" class="btn btn-outline-danger" style="height: 37px" type="button">Send</button>
  </div>
</div>
  </div>
              <div class="loading-indicator" id="loading-indicator" style="display: None">Waiting for response...</div>

    </div>
</div>
              <div class="col-md-5 grid-margin stretch-card">
                <div class="card">
                   <div class="card-header" style="padding: 20px">
     <div class="row">
        <div class="col">
                    <h5 class="card-title">Document handler</h5>
        </div>
        <div class="col-auto">
          <button type="button" onclick="resetFolders()" class="btn btn-outline-warning btn-icon-text">
                            <i class="mdi mdi-reload btn-icon-prepend"></i> Reset </button>
        </div>
    </div>

  </div>
                  <div class="card-body" >
      <div class="dropzone" id="dropzone">
        <p>Upload files</p>
        <input id="formFileMultiple" type="file" style="display: none;" multiple onchange="displayUploadedFiles()">
      </div>

                      <div class="processing-message" id="processing-message"></div>

                    <br>
                    <br>
    <div class="row">
        <div class="col">
                    <h5 class="card-title">Uploaded documents</h5>
        </div>
        <div class="col-auto">
                    <button type="button" class="btn btn-inverse-secondary btn-fw" onclick="processDocuments()">Process documents</button>
        </div>
    </div>


                    <div class="table-container">
                    <div class="table-responsive">
    <table class="table table-hover">
    <thead>
        <tr>
            <th>Document name</th>
        </tr>
    </thead>
    <tbody id="uploadedFilesTableBody">
    </tbody>
</table>
</div>
                    </div>

                    <h5 class="card-title">Processed documents</h5>
                    </p>
                    <div class="table-container">
                    <div class="table-responsive">
    <table class="table table-hover">
    <thead>
        <tr>
            <th>Document name</th>
        </tr>
    </thead>
    <tbody id="processedFilesTableBody">
    </tbody>
</table>
</div>
                    </div>
            <div id="model-ready-message"></div>

  </div>


                  </div>
                </div>
              </div>
            </div>


          <!-- Modal for confirmation -->
<div class="modal" tabindex="-1" role="dialog" id="confirmationModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmation</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this file?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Function to check files and populate tables if needed
function checkAndPopulateTables() {
     var uploadedTableBody = document.getElementById('uploadedFilesTableBody');
     var processedTableBody = document.getElementById('processedFilesTableBody');
     console.log(uploadedTableBody);
     console.log(processedTableBody);
    // Check if either table is empty
     if (uploadedTableBody.childElementCount === 0 || processedTableBody.childElementCount === 0) {
        // Make a request to the server to check files

        fetch('/check_files')
            .then(response => response.json())
            .then(data => {
                // Check if uploaded files need to be displayed
                if (uploadedTableBody.childElementCount === 0 && data.uploadedFiles && data.uploadedFiles.length > 0) {
                    data.uploadedFiles.forEach(fileName => {
                        // Similar logic as in displayUploadedFiles() function
                        var row = uploadedTableBody.insertRow(-1);
                        var cell1 = row.insertCell(0);
                        var cell2 = row.insertCell(1);

                        cell1.textContent = fileName;

                        // Create a unique identifier for the delete button
                        var deleteButtonId = 'deleteButton-uploaded-' + fileName;

                        // Create the delete button with the unique identifier
                        var deleteButton = document.createElement('button');
                        deleteButton.type = 'button';
                        deleteButton.className = 'btn btn-danger';
                        deleteButton.textContent = 'Delete';
                        deleteButton.id = deleteButtonId;

                        // Attach the deleteUploadedDocument function with the corresponding filename
                        deleteButton.addEventListener('click', function (fileNameToDelete) {
                            return function () {
                                deleteUploadedDocument(fileNameToDelete, false);
                            };
                        }(fileName));

                        // Append the delete button to the second cell
                        cell2.appendChild(deleteButton);
                    });
                }

                // Check if processed files need to be displayed
                if (processedTableBody.childElementCount === 0 && data.processedFiles && data.processedFiles.length > 0) {
                    data.processedFiles.forEach(fileName => {
                        // Similar logic as in processDocuments() function
                        var row = processedTableBody.insertRow(-1);
                        var cell1 = row.insertCell(0);
                        var cell2 = row.insertCell(1);

                        cell1.textContent = fileName;

                        // Create a unique identifier for the delete button
                        var deleteButtonId = 'deleteButton-processed-' + fileName;

                        // Create the delete button with the unique identifier
                        var deleteButton = document.createElement('button');
                        deleteButton.type = 'button';
                        deleteButton.className = 'btn btn-danger';
                        deleteButton.textContent = 'Delete';
                        deleteButton.id = deleteButtonId;

                        // Attach the deleteUploadedDocument function with the corresponding filename and set isProcessed to true
                        deleteButton.addEventListener('click', function (fileNameToDelete) {
                            return function () {
                                deleteUploadedDocument(fileNameToDelete, true);
                            };
                        }(fileName));

                        // Append the delete button to the second cell
                        cell2.appendChild(deleteButton);
                    });
                }
            })
            .catch(error => {
                console.error('Error checking files:', error);
            });
    }
}

// Call the function when the page loads
window.addEventListener('load', checkAndPopulateTables);
</script>


<script>
    function displayUploadedFiles() {
        var input = document.getElementById('formFileMultiple');
        var fileList = input.files;
        var tableBody = document.getElementById('uploadedFilesTableBody');

        // Clear previous table content
        tableBody.innerHTML = '';

        if (fileList.length > 0) {
            for (var i = 0; i < fileList.length; i++) {
                var fileName = fileList[i].name;

                var row = tableBody.insertRow(-1);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);

                cell1.textContent = fileName;

                // Create a unique identifier for the delete button
                var deleteButtonId = 'deleteButton-' + i;

                // Create the delete button with the unique identifier
                var deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'btn btn-danger';
                deleteButton.textContent = 'Delete';
                deleteButton.id = deleteButtonId;

                // Attach the deleteUploadedDocument function with the corresponding filename
                deleteButton.addEventListener('click', function (fileNameToDelete) {
                    return function () {
                        deleteUploadedDocument(fileNameToDelete, false);
                    };
                }(fileName));
                // Append the delete button to the second cell
                cell2.appendChild(deleteButton);
            }
        } else {
            // If no files are selected, display a message in the first row
            var row = tableBody.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);

            cell1.textContent = 'No files selected.';
            cell2.textContent = '';
        }
    }

    function deleteUploadedDocument(fileName, isProcessed) {
        // Determine the endpoint based on whether the file is from the processed table
        var deleteEndpoint = isProcessed ? '/delete_document' : '/delete_uploaded_document';

        // Call the appropriate endpoint with the target filename
        fetch(deleteEndpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ fileName: fileName }),
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response if needed
            console.log(data);

            // Remove the corresponding row from the appropriate table
            var tableBody = isProcessed ? document.getElementById('processedFilesTableBody') : document.getElementById('uploadedFilesTableBody');
            var rows = tableBody.getElementsByTagName('tr');

            for (var i = 0; i < rows.length; i++) {
                var cells = rows[i].getElementsByTagName('td');
                if (cells.length > 0 && cells[0].textContent === fileName) {
                    tableBody.removeChild(rows[i]);
                    break;
                }
            }
        })
        .catch(error => {
            console.error('Error deleting document:', error);
        });
    }

    function enableUserInput() {
        document.getElementById('user-input').disabled = false;
        document.querySelector('#chat-container button').disabled = false;
    }

    function processDocuments() {
        var fileList = document.getElementById('formFileMultiple').files;
        var processingMessage = document.getElementById('processing-message');
        var modelReadyMessage = document.getElementById('model-ready-message');
        var uploadedTableBody = document.getElementById('uploadedFilesTableBody');
        var processedTableBody = document.getElementById('processedFilesTableBody');
        var spinnerOverlay = document.getElementById('spinner-overlay'); // Add this line


        if (fileList.length === 0) {
            processingMessage.textContent = 'Please upload documents.';
            return;
        }

            // Show spinner overlay
    spinnerOverlay.style.display = 'flex';

<!--        processingMessage.textContent = 'Documents uploaded. Processing documents...';-->

        var formData = new FormData();
        for (var i = 0; i < fileList.length; i++) {
            formData.append('file', fileList[i]);
        }

        fetch('/upload', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            if (data.message === 'Files parsed and saved successfully') {
                return fetch('/vectorise');
            } else {
                throw new Error('Error processing documents.');
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.message === 'Files vectorised successfully') {
                // Clear the uploaded documents table
                uploadedTableBody.innerHTML = '';

                // Transfer files to the processed documents table
                for (var i = 0; i < fileList.length; i++) {
                    var fileName = fileList[i].name;

                    var row = processedTableBody.insertRow(-1);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);

                    cell1.textContent = fileName;

                    // Create a unique identifier for the delete button
                    var deleteButtonId = 'deleteButton-processed-' + i;

                    // Create the delete button with the unique identifier
                    var deleteButton = document.createElement('button');
                    deleteButton.type = 'button';
                    deleteButton.className = 'btn btn-danger';
                    deleteButton.textContent = 'Delete';
                    deleteButton.id = deleteButtonId;

                    // Attach the deleteUploadedDocument function with the corresponding filename and set isProcessed to true
                    deleteButton.addEventListener('click', function (fileNameToDelete) {
                        return function () {
                            deleteUploadedDocument(fileNameToDelete, true);
                        };
                    }(fileName));

                    // Append the delete button to the second cell
                    cell2.appendChild(deleteButton);
                }

                // Update the interface based on the server response
                modelReadyMessage.textContent = data.message;

                setTimeout(function() {
            modelReadyMessage.textContent = '';  // Clear the message after 5 seconds
        }, 5000);

                enableUserInput();
                hideProcessingMessage();

               // Hide spinner overlay
            spinnerOverlay.style.display = 'none';
            } else {
                throw new Error('Error vectorizing documents.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
<!--            processingMessage.textContent = 'Error processing or vectorizing documents.';-->
        spinnerOverlay.style.display = 'none';

        });
    }
</script>


  <script>
var modalCounter = 1; // Initialize a counter

function sendMessage() {
    var userInput = document.getElementById('user-input').value;
    if (userInput.trim() === '') return;

    showLoadingIndicator();

    // Send user input to Flask endpoint for query completion
    fetch('/query_chain', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ query: userInput }),
    })
    .then(response => response.json())
    .then(data => {
        // Update the interface based on the server response
        appendUserMessage(userInput);
        appendBotMessage(data); // Assuming the server responds with a 'result' field
        console.log(data.sources);
        hideLoadingIndicator();
    })
    .catch(error => {
        console.error('Error:', error);
        hideLoadingIndicator();
    });
}

function showLoadingIndicator() {
    document.getElementById('loading-indicator').style.display = 'block';
}

function hideLoadingIndicator() {
    document.getElementById('loading-indicator').style.display = 'none';
}

function appendUserMessage(message) {
    var chatContainer = document.getElementById('chat-container');
    var userMessageElement = document.createElement('div');
    userMessageElement.className = 'user-message';
    userMessageElement.textContent = 'User: ' + message;
    chatContainer.appendChild(userMessageElement);

    // Clear user input field
    document.getElementById('user-input').value = '';
}

function appendBotMessage(message) {
    var chatContainer = document.getElementById('chat-container');
    var botMessageElement = document.createElement('div');
    botMessageElement.className = 'bot-message text-muted mb-0';
    botMessageElement.innerHTML = 'RAG-E: ' + message.result + '<br>' + '<br>' + '<br>';

    // Append buttons for each key in the sources object
    for (var key in message.sources) {
        if (message.sources.hasOwnProperty(key)) {
            var button = document.createElement('button');
            button.type = 'button';
            button.className = 'btn btn-inverse-primary btn-fw btn-spacing';
            button.dataset.bsToggle = 'modal';
            button.dataset.bsTarget = '#modal-' + modalCounter; // Use the counter for a unique ID
            button.textContent = 'Source ';
            botMessageElement.appendChild(button);

            // Create a modal for each key
            var modal = createModal(modalCounter, key, message.sources[key]);
            var modalTitle = document.createElement('h2');
            modalTitle.innerHTML = 'Source';  // Set your desired title here

            document.body.appendChild(modal);

            modalCounter++; // Increment the counter for the next iteration
        }
    }

    chatContainer.appendChild(botMessageElement);
}

function createModal(counter, key, content) {
    // Create a modal with a unique ID for each key


    var modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'modal-' + counter; // Use the counter for a unique ID
    modal.tabIndex = '-1';
    modal.setAttribute('aria-labelledby', 'modal-' + counter + '-label');
    modal.setAttribute('aria-hidden', 'true');

    var modalDialog = document.createElement('div');
    modalDialog.className = 'modal-dialog modal-dialog-centered modal-dialog-scrollable';
    modal.appendChild(modalDialog);

    var modalContent = document.createElement('div');
    modalContent.className = 'modal-content';
    modalDialog.appendChild(modalContent);

    // Customize the modal content here
    var modalHeader = document.createElement('div');
    modalHeader.className = 'modal-header';
    var modalTitle = document.createElement('h5');
    modalTitle.className = 'modal-title';
    modalTitle.id = 'modal-' + counter + '-label';
    modalTitle.textContent = 'Source';
    modalHeader.appendChild(modalTitle);
    var closeButton = document.createElement('button');
    closeButton.type = 'button';
    closeButton.className = 'btn-close';
    closeButton.dataset.bsDismiss = 'modal';
    closeButton.setAttribute('aria-label', 'Close');
    modalHeader.appendChild(closeButton);
    modalContent.appendChild(modalHeader);

    var modalBody = document.createElement('div');
    modalBody.className = 'modal-body';
    content = content.replace(/\n/g, '<br>');
    modalBody.innerHTML = content;
    modalContent.appendChild(modalBody);

    var modalFooter = document.createElement('div');
    modalFooter.className = 'modal-footer';
    var closeBtn = document.createElement('button');
    closeBtn.type = 'button';
    closeBtn.className = 'btn btn-secondary';
    closeBtn.dataset.bsDismiss = 'modal';
    closeBtn.textContent = 'Close';
    modalFooter.appendChild(closeBtn);
    var saveChangesBtn = document.createElement('button');
    saveChangesBtn.type = 'button';
    //saveChangesBtn.className = 'btn btn-primary';
    //saveChangesBtn.textContent = 'Save Changes';
    //modalFooter.appendChild(saveChangesBtn);
    modalContent.appendChild(modalFooter);

    return modal;
}

    function saveConversation() {
      var chatContainer = document.getElementById('chat-container');
      var conversationText = '';

      var userMessages = chatContainer.getElementsByClassName('user-message');
      var botMessages = chatContainer.getElementsByClassName('bot-message');

      var maxLength = Math.max(userMessages.length, botMessages.length);

      for (var i = 0; i < maxLength; i++) {
        if (i < userMessages.length) {
          conversationText += userMessages[i].textContent + '\n';
        }
        if (i < botMessages.length) {
          conversationText += botMessages[i].textContent + '\n';
        }
      }

      // Save the conversation as a text file
      var blob = new Blob([conversationText], { type: 'text/plain' });
      var a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'conversation.txt';
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script>


<!--            <div class="search-container">-->
<!--  <div class="input-group">-->
<!--    <input type="text" class="form-control" placeholder="Search products">-->
<!--    <div class="input-group-append">-->
<!--      <button class="btn btn-primary ml-2" type="button">Search</button>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->






<!--            <div class="row" style="height: 800px;">-->
<!--              <div class="col-12 grid-margin">-->
<!--                <div class="card h-100 d-flex flex-column">-->
<!--                  <div class="card-body flex-grow-1">-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

          </div>
          <!-- content-wrapper ends -->
          <!-- partial:partials/_footer.html -->

          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="../../static/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../static/vendors/chart.js/Chart.min.js"></script>
    <script src="../../static/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="../../static/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="../../static/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="../../static/vendors/owl-carousel-2/owl.carousel.min.js"></script>
    <script src="../../static/js/jquery.cookie.js" type="text/javascript"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../static/js/off-canvas.js"></script>
    <script src="../../static/js/hoverable-collapse.js"></script>
    <script src="../../static/js/misc.js"></script>
    <script src="../../static/js/settings.js"></script>
    <script src="../../static/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="../../static/js/dashboard.js"></script>
    <!-- End custom js for this page -->
  </body>
</html>